---
phase: 05-service-tests
plan: 04
type: tdd
domain: flutter-testing
---

<objective>
Expand FinanceCalculator tests to achieve 80%+ coverage and ensure edge cases are handled.

Purpose: Current finance_calculator_test.dart covers main scenarios but may miss edge cases, boundary conditions, and less common code paths.

Output: test/services/finance_calculator_test.dart with expanded coverage to reach 80%+
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/TESTING.md
@test/services/finance_calculator_test.dart (existing)
@lib/services/finance_calculator.dart
@lib/config/finance_config.dart

**Tech stack available:**
- Flutter test framework (built-in)
- Existing test patterns

**Established patterns:**
- Current tests cover calculateStatus, calculateTotalExpenses, groupByCategory, getHighestSpendingCategory
- Need to identify gaps and add missing tests

**Key files to reference:**
- lib/services/finance_calculator.dart - Service under test
- lib/config/finance_config.dart - For buffer calculation and config values
- test/services/finance_calculator_test.dart - Existing tests

**Dependencies:**
- Plans 05-01, 05-02, 05-03 - for test patterns
</context>

<feature>
  <name>Expanded FinanceCalculator Tests</name>
  <files>test/services/finance_calculator_test.dart</files>
  <behavior>
    After reading finance_calculator.dart, identify uncovered code paths and add tests:

    Current coverage includes:
    - calculateStatus with various income/expense scenarios ✓
    - calculateTotalExpenses ✓
    - groupByCategory ✓
    - getHighestSpendingCategory ✓
    - FinanceStatus color/emoji ✓

    Potential gaps (verify by reading the service):
    - calculateTotalIncome() - may not have dedicated tests
    - Boundary conditions for calculateStatus (exact buffer, zero values)
    - Edge cases for groupByCategory (empty categories, special characters)
    - NumberFormat edge cases (very large numbers, negative values)
    - FinanceConfig.bufferPercentage variations
    - Multiple insights parameter in calculateStatus

    Test cases should include:
    - calculateTotalIncome() if not tested
    - Boundary values (exactly at buffer thresholds)
    - Very large amounts (millions)
    - Very small amounts (fractions of cents)
    - All valid expense categories
    - Category names with special characters
    - Insights list variations
    - All FinanceStatus color/emoji combinations
  </behavior>
  <implementation>
    1. Read lib/services/finance_calculator.dart completely
    2. Identify any methods or branches not tested
    3. Add new test groups for missing coverage
    4. Add edge case tests to existing groups
    5. Ensure all code paths are exercised

    Example additions:
    - group('calculateTotalIncome', ...) { ... }
    - group('calculateStatus edge cases', ...) { ... }
    - group('NumberFormat edge cases', ...) { ... }
  </implementation>
</feature>

<verification>
Run: flutter test test/services/finance_calculator_test.dart --coverage
Expected: All tests pass, coverage report shows 80%+ for FinanceCalculator
</verification>

<success_criteria>

- All public methods in FinanceCalculator have tests
- Edge cases covered (boundary values, large/small numbers)
- All code branches exercised
- Coverage at 80%+ measured by --coverage
- All existing tests still pass
  </success_criteria>

<output>
After completion, create `.planning/phases/05-service-tests/05-04-SUMMARY.md`:

# Phase 5 Plan 4: Expanded FinanceCalculator Tests Summary

**Expanded FinanceCalculator test coverage to 80%+ with edge case testing**

## Accomplishments

- Added tests for [uncovered methods found]
- Tested edge cases: [list specific edge cases tested]
- Verified boundary conditions for status calculation
- Tested large/small number handling
- Achieved 80%+ coverage for FinanceCalculator

## Files Created/Modified

- `test/services/finance_calculator_test.dart` - Modified: added edge case tests, uncovered method tests

## Decisions Made

- [Decisions about what edge cases to prioritize]
- [How to test boundary conditions]

## Issues Encountered

[Issues if any]

## Next Step

Phase 5 complete, ready for next phase
</output>
