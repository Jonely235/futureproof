---
phase: 04-settings-screen-refactor
plan: 01
type: execute
domain: flutter
---

<objective>
Extract theme picker widget from SettingsScreen into a reusable, testable component.

Purpose: Reduce SettingsScreen complexity by isolating theme selection UI into a focused widget. Enable independent testing of theme picker functionality.
Output: ThemePickerWidget in lib/widgets/theme_picker_widget.dart, SettingsScreen updated to use extracted widget.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md
@lib/screens/settings_screen.dart
@lib/theme/theme_manager.dart
@lib/widgets/bar_chart_widget.dart
@.planning/phases/01-logging-foundation/01-03-SUMMARY.md

# Auto-selected based on dependency graph (from frontmatter):
@.planning/phases/03-error-handling/03-01-SUMMARY.md
@.planning/phases/02-constants-config/02-01-SUMMARY.md

# Key files from frontmatter (relevant to this phase):
@lib/screens/settings_screen.dart
@lib/theme/theme_manager.dart
@lib/widgets/theme_picker_widget.dart (to be created)

**Tech stack available:** Flutter widget composition, Provider state management, Google Fonts, ThemeManager
**Established patterns:** StatelessWidget for reusable components, const constructors, named parameters, camelCase naming, snake_case file names
**Constraining decisions:**
- [Phase 1]: Use AppLogger.settings for logging (not print statements)
- [Phase 3]: Use consistent error handling patterns

**Issues being addressed:**
- Settings screen is 1274 lines (CONCERNS.md:15-18)
- Difficult to maintain and test individual components
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemePickerWidget file and structure</name>
  <files>lib/widgets/theme_picker_widget.dart</files>
  <action>Create new StatelessWidget called ThemePickerWidget. Extract theme selection UI from SettingsScreen._buildThemePicker() (lines ~883-983). Widget must:
- Accept currentTheme parameter (AppTheme enum)
- Accept onThemeChanged callback function
- Display three theme options: Editorial, Minimal, Vibrant
- Use Provider to access ThemeManager for theme state
- Maintain exact same UI appearance as current implementation
- Use Google Fonts (playfairDisplay for titles)
- Follow existing widget patterns from bar_chart_widget.dart (StatelessWidget, const constructors)
- Add AppLogger.widgets for debugging (not print statements)

File location: lib/widgets/theme_picker_widget.dart
Import order: flutter framework, packages (provider, google_fonts), relative imports
</action>
  <verify>File exists at lib/widgets/theme_picker_widget.dart with ThemePickerWidget class, imports are correct, no Dart analysis errors</verify>
  <done>ThemePickerWidget created with proper structure, accepts theme and callback parameters, builds theme selection UI</done>
</task>

<task type="auto">
  <name>Task 2: Update SettingsScreen to use ThemePickerWidget</name>
  <files>lib/screens/settings_screen.dart</files>
  <action>Modify SettingsScreen to use the extracted ThemePickerWidget:
- Remove _buildThemePicker() method (lines ~883-983)
- Add import: import '../widgets/theme_picker_widget.dart';
- Replace _buildThemePicker() call in build method with ThemePickerWidget widget
- Pass currentTheme from Provider.of<ThemeManager>(context).themeMode
- Pass onThemeChanged callback that updates ThemeManager
- Ensure widget rebuilds when theme changes (using context.watch<ThemeManager>)
- Test that theme switching still works correctly

Do NOT modify any other sections of SettingsScreen - only the theme picker section.
</action>
  <verify>SettingsScreen no longer contains _buildThemePicker method, imports ThemePickerWidget, app still compiles and runs, theme switching works</verify>
  <done>SettingsScreen uses ThemePickerWidget, theme selection functionality preserved, file is ~100 lines shorter</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>ThemePickerWidget extracted and integrated into SettingsScreen</what-built>
  <how-to-verify>
    1. Run: flutter run (or start app normally)
    2. Navigate to Settings screen
    3. Scroll to Appearance section
    4. Tap each theme option (Editorial, Minimal, Vibrant)
    5. Verify theme changes immediately across app
    6. Check console for AppLogger.widgets messages
    7. Confirm UI looks identical to before extraction
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `flutter analyze` passes with no errors
- [ ] `dart format --output=none --set-exit-if-changed .` passes (code is formatted)
- [ ] Theme switching works for all three themes
- [ ] No visual regressions in Settings screen
- [ ] Settings screen file reduced by ~100 lines
- [ ] AppLogger.widgets used (not print statements)
</verification>

<success_criteria>

- ThemePickerWidget exists as independent, reusable widget
- SettingsScreen uses ThemePickerWidget instead of _buildThemePicker method
- Theme functionality unchanged (all three themes work)
- Code follows established widget patterns
- No Dart analysis errors
- User verified theme switching works correctly
  </success_criteria>

<output>
After completion, create `.planning/phases/04-settings-screen-refactor/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Theme Picker Extraction Summary

**Extracted theme picker into reusable ThemePickerWidget, reducing SettingsScreen complexity**

## Accomplishments

- Created ThemePickerWidget as independent, testable component
- Reduced SettingsScreen by ~100 lines
- Preserved all theme switching functionality
- Followed established widget composition patterns
- Added AppLogger.widgets for debugging

## Files Created/Modified

- `lib/widgets/theme_picker_widget.dart` - New extracted widget
- `lib/screens/settings_screen.dart` - Updated to use ThemePickerWidget

## Decisions Made

- Extract as StatelessWidget (theme state managed by ThemeManager, not widget)
- Keep Provider integration in widget (access ThemeManager via context.watch)
- Maintain exact UI appearance from original implementation
- Use AppLogger.widgets for consistency with Phase 1

## Issues Encountered

None

## Next Phase Readiness

âœ… Theme picker extraction complete - widget is independent and reusable
- Ready for 04-02 (Smart Insights extraction)
- Pattern established for widget extraction (StatelessWidget, const constructors, named parameters)
- Settings screen reduced from 1274 to ~1174 lines

---
*Phase: 04-settings-screen-refactor*
*Completed: 2026-01-11*
</output>
